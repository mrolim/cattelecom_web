(function(a){function b(b,d){var k,l,m,t,e=this,f=jQuery.extend({},{width:b.width(),height:b.height(),enableMouse:!0,activateOnClick:!1,sensitivityX:.5,sensitivityY:.4,easingCoefficient:7,autoZCoordinate:!0,useCustomZ:!0,focusZ:0},d),g=0,h=0,i=0,j=0,n=-1,o=-1,p=Array(),q=Array(),r=!1,s=!1,u=function(){b.width(f.width),b.height(f.height),k=b.children("div"),l=k.length,m=Array(),t=b.css("position"),"static"==t&&b.css("position","relative"),k.css("padding","0"),k.css("margin","0"),k.css("position","absolute"),v(),G(),w(),x(),"static"==t&&b.css("position","static")},v=function(){for(var c=b.offset(),d=0;l>d;d++){m[d]={};var e=parseFloat(jQuery(k[d]).data("z"));isNaN(e)||(m[d].z=e);var f=jQuery(k[d]).data("lock");void 0!=f?("string"==typeof f&&(f=f.replace(/^\s+|\s+$/g,"").toLowerCase()),"false"!=f&&0!=f&&"no"!=f&&(m[d].locked=!0)):m[d].locked=!1;var g=jQuery(k[d]).attr("id");void 0!=g&&(m[d].id=g);var h=a(k[d]).offset();m[d].x=h.left-c.left,m[d].y=h.top-c.top,E(d,m[d].x,m[d].y)}},w=function(){for(var a=100,b=-2*a/l,c=0;l>c;c++)1==f.autoZCoordinate?f.useCustomZ&&void 0!=m[c].z?m[c].z=m[c].z:(m[c].z=a,a+=b):void 0==m[c].z&&(m[c].z=f.focusZ)},x=function(){b.unbind("mousemove",A),b.unbind("mousedown",A),1==f.enableMouse&&(1==f.activateOnClick?b.bind("mousedown",A):b.bind("mousemove",A))},A=function(c){if(0!=f.sensitivityX){var d=a("html").scrollLeft();d||(d=a("body").scrollLeft());var i=c.clientX-b.offset().left+d;i>f.width?i=f.width:0>i&&(i=0),g=i-f.width/2}if(0!=f.sensitivityY){var d=a("html").scrollTop();d||(d=a("body").scrollTop());var j=c.clientY-b.offset().top+d;j>f.height?j=f.height:0>j&&(j=0),h=j-f.height/2}1==r&&e.stopChain(),B(),J("mouseToRatio",{x:i/f.width,y:j/f.height})},B=function(){D(),-1==n&&(n=setInterval(F,20))},C=function(){clearInterval(n),n=-1},D=function(){-1!=o&&(clearTimeout(o),o=-1)},E=function(a,b,c){k[a].style.left=b+"px",k[a].style.top=c+"px"},F=function(){var a=g-i,b=h-j;1>Math.abs(a)&&1>Math.abs(b)&&(C(),I()),i+=a/(1+f.easingCoefficient),j+=b/(1+f.easingCoefficient);for(var c=0;l>c;c++)if(1!=m[c].locked){var d=.01*(m[c].z-f.focusZ);E(c,m[c].x-i*f.sensitivityX*d,m[c].y-j*f.sensitivityY*d)}},G=function(){for(var b=0;l>b;b++)a(k[b]).find(">img").hide().one("load",function(){a(this).fadeIn(800,function(){jQuery.browser.msie&&this.style.removeAttribute("filter")})}).each(function(){this.complete&&this.width>0&&a(this).trigger("load")})},H=function(){if(p.length>0){var a=p.shift();return 1==s&&p.push(a),a}return!1},I=function(){1==r&&e.startChain(s)},J=function(b,d){if(q.length>0)for(var e=0;q.length>e;e++)a("#"+q[e])[c](b,d)};this.option=function(a,b){if(a!==void 0)if(a=a.replace(/^\s+|\s+$/g,""),"enableMouse"==a||"activateOnClick"==a){if(b===void 0)return f[a];f[a]=Boolean(b),x(),"enableMouse"==a&&I()}else if(void 0!=f[a]){if(void 0===b||isNaN(parseFloat(b)))return f[a];f[a]=parseFloat(b)}},this.layer=function(a,b){if(a!==void 0){var c=0,d=l,e=!isNaN(parseInt(a));e&&(c=Math.min(parseInt(a),l-1),d=c+1);for(var f=c;d>f;f++)if(1==e||m[f].id==a){if(void 0===b)return m[f];void 0!=b.x&&(m[f].x=b.x),void 0!=b.y&&(m[f].y=b.y),void 0!=b.z&&(m[f].z=b.z),void 0!=b.locked&&(m[f].locked=Boolean(b.locked)),F();break}}},this.toggleMouse=function(){f.enableMouse=!f.enableMouse,x(),I()},this.pause=function(a){-1!=n?(C(),a>0&&(D(),o=setTimeout(B,a))):1==r&&(D(),o=setTimeout(I,a))},this.update=function(){F()},this.unpause=function(){B()},this.triggerPause=function(){-1!=n?C():B()},this.stop=function(){g=i,h=j,I()},this.mouseTo=function(a){var b=g,c=h;"object"==typeof a&&(isNaN(parseFloat(a.x))||(b=a.x-f.width/2),isNaN(parseFloat(a.y))||(c=a.y-f.height/2)),g=b,h=c,B()},this.mouseToRatio=function(a){g=(a.x-.5)*f.width,h=(a.y-.5)*f.height,B()},this.mouseToRandom=function(){g=(.5-Math.random())*f.width,h=(.5-Math.random())*f.height,B()},this.reset=function(){g=0,h=0,B()},this.centerTo=function(a){var b=g,c=h;if("object"==typeof a&&a.id!==void 0&&""!=a.id)for(var d=0;l>d;d++)if(m[d].id==a.id){var e=.01*(m[d].z-f.focusZ);if(0!=e){var i=1,j=1,n=0,o=0;a.align!==void 0&&""!=a.align&&(a.align=a.align.toLowerCase(),-1!=a.align.indexOf("l")?i=0:-1!=a.align.indexOf("r")&&(i=2),-1!=a.align.indexOf("t")?j=0:-1!=a.align.indexOf("b")&&(j=2)),isNaN(parseFloat(a.offx))||(n=parseFloat(a.offx)),isNaN(parseFloat(a.offy))||(o=parseFloat(a.offy)),0!=f.sensitivityX&&(b=(m[d].x-n-.5*(f.width-i*jQuery(k[d]).width()))/(e*f.sensitivityX)),0!=f.sensitivityY&&(c=(m[d].y-o-.5*(f.height-j*jQuery(k[d]).height()))/(e*f.sensitivityY))}break}g=b,h=c,B()},this.addToChain=function(){void 0!=arguments[0]&&(void 0!=arguments[1]?p.push({method:arguments[0],parameters:arguments[1]}):p.push({method:arguments[0]}))},this.clearChain=function(){p=[]},this.startChain=function(a){s=Boolean(a),r=!0,action=H(),0!=action?void 0!=action.parameters?e[action.method](action.parameters):e[action.method]():r=!1},this.stopChain=function(){r=!1,D(),-1!=n&&C()},this.linkWith=function(){var a=Array.prototype.slice.apply(arguments);q.push(a)},this.resetLinks=function(){q=[]},u()}var c="parallax";a.fn[c]=function(d){var f,g,e=arguments;if(0==this.length)return!1;if(f=a(this),g=f.data(c)){if(g[d])return g[d].apply(this,Array.prototype.slice.call(e,1))}else if("object"==typeof d||!d)return f.data(c,new b(f,d))}})(jQuery);